{% extends "base.html" %}

{% block app_content %}
<div class="row">
    <div class="col-md-4">
        <fieldset class="form-group">
            <div class="accordion" id="accordion">

                <div class="card">
                    <div class="card-header" id="heading1">
                        <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse1" aria-expanded="true" aria-controls="collapse1">
                            <span class="fas fa-file" aria-hidden="true"></span> Label Size
                        </button>
                    </div>
                    <div id="collapse1" class="collapse" aria-labelledby="heading1" data-parent="#accordion">
                        <div class="card-body">
                            <label for="labelSize" style="margin-bottom: 0">Label Size:</label>
                            <select class="form-control" id="labelSize" onChange="preview()">
                                {% for label_size in label_sizes %}<option value="{{label_size[0]}}" data-round="{{label_size[2]}}" data-head-width="{{label_size[3]}}" {% if default_label_size == label_size[0] %}selected{% endif %}>{{label_size[1]}}</option>{% endfor %}
                            </select>

                            <label for="orientation" class="control-label input-group" style="margin-top: 10px; margin-bottom: 0">Label Orientation:</label>
                            <div class="btn-group btn-group-toggle btn-block" data-toggle="buttons">
                                <label class="btn btn-secondary {% if default_orientation == 'standard' %}active{% endif %}" id="orientation_standard">
                                    <input type="radio" name="orientation" onchange="preview()" value="standard" aria-label="Standard" {% if default_orientation == 'standard' %}checked{% endif %}>
                                    <span class="fas fa-ruler-horizontal" aria-hidden="true"> Standard
                                </label>
                                <label class="btn btn-secondary {% if default_orientation == 'rotated' %}active{% endif %}" id="orientation_rotated">
                                    <input type="radio" name="orientation" onchange="preview()" value="rotated" aria-label="Rotated" {% if default_orientation == 'rotated' %}checked{% endif %}>
                                    <span class="fas fa-ruler-vertical" aria-hidden="true"> Rotated
                                </label>
                            </div>

                            {% if red_support %}
                            <label for="printColor" class="control-label input-group" style="margin-top: 10px; margin-bottom: 0">Print Color:</label>
                            <div class="btn-group btn-group-toggle btn-block" data-toggle="buttons">
                                <label class="btn btn-dark" id="print_color_black">
                                    <input type="radio" name="printColor" onchange="preview()" value="black" aria-label="Black">Black
                                </label>
                                <label class="btn btn-danger" id="print_color_red">
                                    <input type="radio" name="printColor" onchange="preview()" value="red" aria-label="Red">Red
                                </label>
                            </div>
                            {% endif %}

                        </div>
                        <!-- class="card-body" -->
                    </div>
                </div>

                <div class="card">
                    <div class="card-header" id="heading2">
                        <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse2" aria-expanded="true" aria-controls="collapse2">
                            <span class="fas fa-font" aria-hidden="true"></span> Font Settings
                        </button>
                    </div>
                    <div id="collapse2" class="collapse show" aria-labelledby="heading2" data-parent="#accordion">
                        <div class="card-body">
                            <label for="fontFamily" style="margin-bottom: 0">Font Family:</label>
                            <select class="form-control" id="fontFamily" onChange="updateStyles()">
                                {% for font_family_name in font_family_names %}
                                    <option {% if default_font_family == font_family_name %}selected{% endif %}>{{font_family_name}}</option>
                                {% endfor %}
                            </select>

                            <label for="fontStyle" style="margin-top: 10px; margin-bottom: 0">Font Style:</label>
                            <select class="form-control" id="fontStyle" onChange="preview()">
                            </select>

                            <label for="fontSize" style="margin-top: 10px; margin-bottom: 0">Font Size (pt):</label>
                            <input id="fontSize" class="form-control" type="number" min="1" value="{{default_font_size}}" onChange="preview()" required>

                            <label for="fontAlign" class="control-label input-group" style="margin-top: 10px; margin-bottom: 0">Font Alignment:</label>
                            <div class="btn-group btn-group-toggle" data-toggle="buttons">
                                <label class="btn btn-secondary ">
                                    <input type="radio" name="fontAlign" onchange="preview()" value="left" aria-label="Left Align"><span class="fas fa-align-left" aria-hidden="true"></span>
                                </label>
                                <label class="btn btn-secondary active">
                                    <input type="radio" name="fontAlign" onchange="preview()" value="center" aria-label="Center Align" checked=""><span class="fas fa-align-center" aria-hidden="true"></span>
                                </label>
                                <label class="btn btn-secondary">
                                    <input type="radio" name="fontAlign" onchange="preview()" value="right" aria-label="Right Align"><span class="fas fa-align-right" aria-hidden="true"></span>
                                </label>
                            </div>

                            <label for="lineSpacing" class="control-label input-group" style="margin-top: 10px; margin-bottom: 0">Line Spacing:</label>
                            <div class="btn-group btn-group-toggle" data-toggle="buttons" style="display: flex; flex-wrap: wrap;">
                                {% for line_spacing in line_spacings %}
                                <label class="btn btn-secondary btn-sm {% if default_line_spacing == line_spacing %}active{% endif %}" id="lineSpacing{{line_spacing}}" style="flex: 0 0 auto; margin: 2px;">
                                    <input type="radio" name="lineSpacing" onchange="preview()" value="{{line_spacing}}" aria-label="{{line_spacing}}%" {% if default_line_spacing == line_spacing %}checked{% endif %}>{{line_spacing}}%
                                </label>
                                {% endfor %}
                            </div>

                        </div>
                        <!-- class="card-body" -->
                    </div>
                </div>

                <div class="card">
                    <div class="card-header" id="heading4">
                        <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse4" aria-expanded="true" aria-controls="collapse4">
                            <span class="fas fa-qrcode" aria-hidden="true"></span> QR Code Settings
                        </button>
                    </div>
                    <div id="collapse4" class="collapse" aria-labelledby="heading4" data-parent="#accordion">
                        <div class="card-body">
                            <label for="qrCodeSize" style="margin-bottom: 0">QR Code Size:</label>
                            <input id="qrCodeSize" class="form-control" type="number" min="1" value="{{default_qr_size}}" onChange="preview()" required>

                            <label for="qrCodeCorrection" style="margin-top: 10px; margin-bottom: 0">Error Correction:</label>
                            <select class="form-control" id="qrCodeCorrection" onChange="preview()">
                                <option value="L">About 7% can be corrected.</option>
                                <option value="M">About 15% can be corrected.</option>
                                <option value="Q">About 25% can be corrected.</option>
                                <option value="H">About 30% can be corrected.</option>
                            </select>
                        </div>
                        <!-- class="card-body" -->
                    </div>
                </div>

                <div class="card">
                    <div class="card-header" id="heading5">
                        <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse5" aria-expanded="true" aria-controls="collapse5">
                            <span class="fas fa-image" aria-hidden="true"></span> Image Settings
                        </button>
                    </div>
                    <div id="collapse5" class="collapse" aria-labelledby="heading5" data-parent="#accordion">
                        <div class="card-body">
                            <label for="imageMode" class="control-label input-group" style="margin-top: 10px; margin-bottom: 0">Image mode:</label>

                            <label class="btn btn-secondary {% if default_image_mode == 'black_and_white' %}active{% endif %}" id="image_mode_bw">
                                <input type="radio" name="imageMode" onchange="preview()" value="black_and_white" aria-label="Black & White" {% if default_image_mode == 'black_and_white' %}checked{% endif %}>
                                <span class="fas fa-ruler-horizontal" aria-hidden="true"> Black & White
                            </label>
                            <label class="btn btn-secondary {% if default_image_mode == 'grayscale' %}active{% endif %}" id="image_mode_grayscale">
                                <input type="radio" name="imageMode" onchange="preview()" value="grayscale" aria-label="Grayscale" {% if default_image_mode == 'grayscale' %}checked{% endif %}>
                                <span class="fas fa-ruler-vertical" aria-hidden="true"> Grayscale
                            </label>
                            {% if red_support %}
                            <label class="btn btn-secondary {% if default_image_mode == 'colored' %}active{% endif %}" id="image_mode_colored">
                                <input type="radio" name="imageMode" onchange="preview()" value="colored" aria-label="Colored" {% if default_image_mode == 'colored' %}checked{% endif %}>
                                <span class="fas fa-ruler-horizontal" aria-hidden="true"> Colored
                            </label>
                            <label class="btn btn-secondary {% if default_image_mode == 'red_and_black' %}active{% endif %}" id="image_mode_red_and_black">
                                <input type="radio" name="imageMode" onchange="preview()" value="red_and_black" aria-label="Red & Black" {% if default_image_mode == 'red_and_black' %}checked{% endif %}>
                                <span class="fas fa-ruler-vertical" aria-hidden="true"> Red & Black
                            </label>
                            {% endif %}
                               

                            <label for="imageBwThreshold" style="margin-top: 10px; margin-bottom: 0">Black & White threshold:</label>
                            <input id="imageBwThreshold" class="form-control" type="number" min="1" max="255" value="{{default_bw_threshold}}" onChange="preview()">
                        </div>
                        <!-- class="card-body" -->
                    </div>
                </div>

                <div class="card">
                    <div class="card-header" id="heading3">
                        <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse3" aria-expanded="true" aria-controls="collapse3">
                            <span class="fas fa-cog" aria-hidden="true"></span> Detailed Settings
                        </button>
                    </div>
                    <div id="collapse3" class="collapse" aria-labelledby="heading3" data-parent="#accordion">
                        <div class="card-body">
                            <label for="marginTop" style="margin-bottom: 0">Margin Top:</label>
                            <div class="input-group marginsTopBottom">
                                <input id="marginTop" class="form-control" type="number" min="0" max="200" value="{{default_margin_top}}" onChange="preview()" aria-describedby="marginTop-addon" required>
                                <div class="input-group-append">
                                    <span class="input-group-text" id="marginTop-addon">%</span>
                                </div>
                            </div>
                            <label for="marginBottom" style="margin-top: 10px; margin-bottom: 0">Margin Bottom:</label>
                            <div class="input-group marginsTopBottom">
                                <input id="marginBottom" class="form-control" type="number" min="0" max="200" value="{{default_margin_bottom}}" onChange="preview()" aria-describedby="marginBottom-addon" required>
                                <div class="input-group-append">
                                    <span class="input-group-text" id="marginBottom-addon">%</span>
                                </div>
                            </div>
                            <label for="marginLeft" style="margin-top: 10px; margin-bottom: 0">Margin Left:</label>
                            <div class="input-group marginsLeftRight">
                                <input id="marginLeft" class="form-control" type="number" min="0" max="200" value="{{default_margin_left}}" onChange="preview()" aria-describedby="marginLeft-addon" required>
                                <div class="input-group-append">
                                    <span class="input-group-text" id="marginLeft-addon">%</span>
                                </div>
                            </div>
                            <label for="marginRight" style="margin-top: 10px; margin-bottom: 0">Margin Right:</label>
                            <div class="input-group marginsLeftRight">
                                <input id="marginRight" class="form-control" type="number" min="0" max="200" value="{{default_margin_right}}" onChange="preview()" aria-describedby="marginRight-addon" required>
                                <div class="input-group-append">
                                    <span class="input-group-text" id="marginRight-addon">%</span>
                                </div>
                            </div>
                        </div>
                        <!-- class="card-body" -->
                    </div>
                </div>
            </div>
        </fieldset>
    </div>
    <div class="col-md-4">
        <label for="printType" class="control-label input-group" style="margin-bottom: 0">Print Type:</label>
        <div class="btn-group btn-group-toggle btn-block print-type-group" data-toggle="buttons">
            <label class="btn btn-secondary active" id="printTypeText">
                <input type="radio" name="printType" onchange="updateOrientationRestrictions(); preview()" value="text" aria-label="Text" checked>
                <span class="fas fa-font" aria-hidden="true"></span><br>Text
            </label>
            <label class="btn btn-secondary" id="printTypeQrCode">
                <input type="radio" name="printType" onchange="updateOrientationRestrictions(); preview()" value="qrcode" aria-label="Text">
                <span class="fas fa-qrcode" aria-hidden="true"></span><br>QR Code
            </label>
            <label class="btn btn-secondary" id="printTypeQrCodeText">
                <input type="radio" name="printType" onchange="updateOrientationRestrictions(); preview()" value="qrcode_text" aria-label="QR & Text">
                <span class="fas fa-qrcode" aria-hidden="true"></span><br>QR &amp; Text
            </label>
            <label class="btn btn-secondary" id="printTypeMarkdown">
                <input type="radio" name="printType" onchange="updateOrientationRestrictions(); preview()" value="markdown" aria-label="MD">
                <span class="fas fa-code" aria-hidden="true"></span><br>MD
            </label>
            <label class="btn btn-secondary" id="printTypeImage">
                <input type="radio" name="printType" onchange="updateOrientationRestrictions(); preview()" value="image" aria-label="Image">
                <span class="fas fa-image" aria-hidden="true"></span><br>Image
            </label>
        </div>

        <fieldset class="form-group" id="groupLabelText">
            <label for="labelText" style="margin-top: 10px; margin-bottom: 0">Label Text:</label>
            <textarea rows="7" id="labelText" class="form-control" onChange="preview()" onInput="preview()"></textarea>
            <!-- Streamlined Markdown Controls -->
            <div id="markdownOptions" style="display: none; margin-top: 10px;">
                <!-- First Row: Auto + Preview -->
                <div class="d-flex align-items-center mb-2" style="gap: 0.5rem;">
                    <label class="btn btn-sm btn-outline-secondary btn-toggle mb-0" id="markdownAutoRenderBtn" title="Auto-render preview on text change">
                        <input type="checkbox" id="markdownAutoRender" onChange="onMarkdownAutoRenderToggle()">
                        <span class="fas fa-sync"></span> Auto
                    </label>
                    <button type="button" id="renderMarkdownButton" class="btn btn-sm btn-primary" onClick="renderMarkdown()" style="margin-left: auto;">
                        <span class="fas fa-eye"></span> Preview
                    </button>
                </div>

                <!-- Second Row: Paged + Height -->
                <div class="d-flex align-items-center" style="gap: 0.5rem;">
                    <label class="btn btn-sm btn-outline-secondary btn-toggle mb-0" id="markdownPagedBtn" title="Enable paged mode for long content">
                        <input type="checkbox" id="markdownPaged" onChange="onMarkdownPagedToggle()">
                        <span class="fas fa-file-alt"></span> Paged
                    </label>
                    <div id="markdownPagedInputs" class="d-flex align-items-center" style="display: none; gap: 0.4rem;">
                        <label for="markdownSliceMm" class="mb-0" style="font-size: 0.875rem;">Height:</label>
                        <input id="markdownSliceMm" class="form-control form-control-sm" type="number" min="10" max="999" step="1" value="90" onChange="preview()" style="width: 70px;">
                        <span style="font-size: 0.875rem; color: #6c757d;">mm</span>
                    </div>
                </div>
                <div class="border-areas-container" style="margin-top: 15px; padding-top: 10px; border-top: 1px solid #dee2e6;">
                    <label class="section-label" style="font-weight: bold; margin-bottom: 8px;">Border Areas:</label>

                    <!-- Tab Navigation -->
                    <ul class="nav nav-pills nav-fill border-area-tabs" role="tablist">
                        <li class="nav-item">
                            <a class="nav-link active" id="leftAreaTab" data-toggle="tab" href="#leftAreaContent" role="tab">
                                <span class="fas fa-angle-left"></span> Left
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="rightAreaTab" data-toggle="tab" href="#rightAreaContent" role="tab">
                                <span class="fas fa-angle-right"></span> Right
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="topAreaTab" data-toggle="tab" href="#topAreaContent" role="tab">
                                <span class="fas fa-angle-up"></span> Top
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="bottomAreaTab" data-toggle="tab" href="#bottomAreaContent" role="tab">
                                <span class="fas fa-angle-down"></span> Bottom
                            </a>
                        </li>
                    </ul>

                    <!-- Tab Content -->
                    <div class="tab-content border-area-content">
                        <!-- Left Area -->
                        <div class="tab-pane fade show active" id="leftAreaContent" role="tabpanel">
                            <div class="form-check border-area-enable-toggle">
                                <input class="form-check-input" type="checkbox" id="enableLeftArea" onChange="toggleHeaderArea('left'); preview()">
                                <label class="form-check-label" for="enableLeftArea">Enable Left Area</label>
                            </div>
                            <div id="leftAreaOptions" class="border-area-options" style="display: none;">
                                <!-- Area Sizing -->
                                <div class="form-group">
                                    <label for="leftAreaMm" class="small-bold-label">Area Width (mm)</label>
                                    <input id="leftAreaMm" class="form-control form-control-sm" type="number" min="0" max="999.9" step="0.5" value="0" onChange="preview()">
                                </div>

                                <!-- Content Type Selector -->
                                <div class="form-group">
                                    <label class="small-bold-label">Content Type</label>
                                    <div class="btn-group btn-group-toggle w-100 content-type-selector" data-toggle="buttons">
                                        <label class="btn btn-outline-secondary active" id="leftContentNone">
                                            <input type="radio" name="leftContentType" value="none" onchange="toggleBorderContentType('left', 'none'); preview()" checked>
                                            <span class="fas fa-ban"></span> None
                                        </label>
                                        <label class="btn btn-outline-secondary" id="leftContentBar">
                                            <input type="radio" name="leftContentType" value="bar" onchange="toggleBorderContentType('left', 'bar'); preview()">
                                            <span class="fas fa-bars"></span> Bar
                                        </label>
                                    </div>
                                </div>

                                <!-- Bar Settings -->
                                <div id="leftBarContent" class="border-content-section" style="display: none;">
                                    <div class="form-row">
                                        <div class="form-group col-4">
                                            <label for="leftBarMm">Width (mm)</label>
                                            <input id="leftBarMm" class="form-control form-control-sm" type="number" min="0" max="999.9" step="0.5" value="0" onChange="preview()">
                                        </div>
                                        <div class="form-group col-4">
                                            <label for="leftBarTextSizePt">Text (pt)</label>
                                            <input id="leftBarTextSizePt" class="form-control form-control-sm" type="number" min="0" max="999" step="1" value="0" onChange="preview()" placeholder="Auto">
                                        </div>
                                        <div class="form-group col-4">
                                            <label>Color</label>
                                            <div class="btn-group btn-group-sm btn-group-toggle w-100" data-toggle="buttons">
                                                <label class="btn btn-outline-dark active" id="leftBarColorBlack">
                                                    <input type="radio" name="leftBarColor" onchange="preview()" value="black" checked>B
                                                </label>
                                                {% if red_support %}
                                                <label class="btn btn-outline-danger" id="leftBarColorRed">
                                                    <input type="radio" name="leftBarColor" onchange="preview()" value="red">R
                                                </label>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group mb-0">
                                        <label for="leftBarText">Label</label>
                                        <input id="leftBarText" class="form-control form-control-sm" type="text" value="" onChange="preview()" placeholder="Bar label text">
                                    </div>
                                </div>

                                <!-- Text Settings -->
                                <div id="leftTextContent" class="border-content-section" style="display: none;">
                                    <div class="form-group mb-0">
                                        <label for="leftText">Content</label>
                                        <input id="leftText" class="form-control form-control-sm" type="text" value="" onChange="preview()" placeholder="Text content">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Right Area -->
                        <div class="tab-pane fade" id="rightAreaContent" role="tabpanel">
                            <div class="form-check border-area-enable-toggle">
                                <input class="form-check-input" type="checkbox" id="enableRightArea" onChange="toggleHeaderArea('right'); preview()">
                                <label class="form-check-label" for="enableRightArea">Enable Right Area</label>
                            </div>
                            <div id="rightAreaOptions" class="border-area-options" style="display: none;">
                                <!-- Area Sizing -->
                                <div class="form-group">
                                    <label for="rightAreaMm" class="small-bold-label">Area Width (mm)</label>
                                    <input id="rightAreaMm" class="form-control form-control-sm" type="number" min="0" max="999.9" step="0.5" value="0" onChange="preview()">
                                </div>

                                <!-- Content Type Selector -->
                                <div class="form-group">
                                    <label class="small-bold-label">Content Type</label>
                                    <div class="btn-group btn-group-toggle w-100 content-type-selector" data-toggle="buttons">
                                        <label class="btn btn-outline-secondary active" id="rightContentNone">
                                            <input type="radio" name="rightContentType" value="none" onchange="toggleBorderContentType('right', 'none'); preview()" checked>
                                            <span class="fas fa-ban"></span> None
                                        </label>
                                        <label class="btn btn-outline-secondary" id="rightContentBar">
                                            <input type="radio" name="rightContentType" value="bar" onchange="toggleBorderContentType('right', 'bar'); preview()">
                                            <span class="fas fa-bars"></span> Bar
                                        </label>
                                    </div>
                                </div>

                                <!-- Bar Settings -->
                                <div id="rightBarContent" class="border-content-section" style="display: none;">
                                    <div class="form-row">
                                        <div class="form-group col-4">
                                            <label for="rightBarMm">Width (mm)</label>
                                            <input id="rightBarMm" class="form-control form-control-sm" type="number" min="0" max="999.9" step="0.5" value="0" onChange="preview()">
                                        </div>
                                        <div class="form-group col-4">
                                            <label for="rightBarTextSizePt">Text (pt)</label>
                                            <input id="rightBarTextSizePt" class="form-control form-control-sm" type="number" min="0" max="999" step="1" value="0" onChange="preview()" placeholder="Auto">
                                        </div>
                                        <div class="form-group col-4">
                                            <label>Color</label>
                                            <div class="btn-group btn-group-sm btn-group-toggle w-100" data-toggle="buttons">
                                                <label class="btn btn-outline-dark active" id="rightBarColorBlack">
                                                    <input type="radio" name="rightBarColor" onchange="preview()" value="black" checked>B
                                                </label>
                                                {% if red_support %}
                                                <label class="btn btn-outline-danger" id="rightBarColorRed">
                                                    <input type="radio" name="rightBarColor" onchange="preview()" value="red">R
                                                </label>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group mb-0">
                                        <label for="rightBarText">Label</label>
                                        <input id="rightBarText" class="form-control form-control-sm" type="text" value="" onChange="preview()" placeholder="Bar label text">
                                    </div>
                                </div>

                                <!-- Text Settings -->
                                <div id="rightTextContent" class="border-content-section" style="display: none;">
                                    <div class="form-group mb-0">
                                        <label for="rightText">Content</label>
                                        <input id="rightText" class="form-control form-control-sm" type="text" value="" onChange="preview()" placeholder="Text content">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Top Area -->
                        <div class="tab-pane fade" id="topAreaContent" role="tabpanel">
                            <div class="form-check border-area-enable-toggle">
                                <input class="form-check-input" type="checkbox" id="enableTopArea" onChange="toggleHeaderArea('top'); preview()">
                                <label class="form-check-label" for="enableTopArea">Enable Top Area</label>
                            </div>
                            <div id="topAreaOptions" class="border-area-options" style="display: none;">
                                <!-- Area Sizing -->
                                <div class="form-group">
                                    <label for="topAreaMm" class="small-bold-label">Area Height (mm)</label>
                                    <input id="topAreaMm" class="form-control form-control-sm" type="number" min="0" max="999.9" step="0.5" value="0" onChange="preview()">
                                </div>

                                <!-- Content Type Selector -->
                                <div class="form-group">
                                    <label class="small-bold-label">Content Type</label>
                                    <div class="btn-group btn-group-toggle w-100 content-type-selector" data-toggle="buttons">
                                        <label class="btn btn-outline-secondary active" id="topContentNone">
                                            <input type="radio" name="topContentType" value="none" onchange="toggleBorderContentType('top', 'none'); preview()" checked>
                                            <span class="fas fa-ban"></span> None
                                        </label>
                                        <label class="btn btn-outline-secondary" id="topContentBar">
                                            <input type="radio" name="topContentType" value="bar" onchange="toggleBorderContentType('top', 'bar'); preview()">
                                            <span class="fas fa-bars"></span> Bar
                                        </label>
                                        <label class="btn btn-outline-secondary" id="topContentText">
                                            <input type="radio" name="topContentType" value="text" onchange="toggleBorderContentType('top', 'text'); preview()">
                                            <span class="fas fa-font"></span> Text
                                        </label>
                                    </div>
                                </div>

                                <!-- Bar Settings -->
                                <div id="topBarContent" class="border-content-section" style="display: none;">
                                    <div class="form-row">
                                        <div class="form-group col-4">
                                            <label for="topBarMm">Height (mm)</label>
                                            <input id="topBarMm" class="form-control form-control-sm" type="number" min="0" max="999.9" step="0.5" value="0" onChange="preview()">
                                        </div>
                                        <div class="form-group col-4">
                                            <label for="topBarTextSizePt">Text (pt)</label>
                                            <input id="topBarTextSizePt" class="form-control form-control-sm" type="number" min="0" max="999" step="1" value="0" onChange="preview()" placeholder="Auto">
                                        </div>
                                        <div class="form-group col-4">
                                            <label class="mb-1">Color</label>
                                            <div class="btn-group btn-group-sm btn-group-toggle w-100" data-toggle="buttons">
                                                <label class="btn btn-outline-dark active" id="topBarColorBlack">
                                                    <input type="radio" name="topBarColor" onchange="preview()" value="black" checked>B
                                                </label>
                                                {% if red_support %}
                                                <label class="btn btn-outline-danger" id="topBarColorRed">
                                                    <input type="radio" name="topBarColor" onchange="preview()" value="red">R
                                                </label>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group mb-0">
                                        <label for="topBarText" class="mb-1">Label</label>
                                        <input id="topBarText" class="form-control form-control-sm" type="text" value="" onChange="preview()" placeholder="Bar label text">
                                    </div>
                                </div>

                                <!-- Text Settings -->
                                <div id="topTextContent" class="border-content-section" style="display: none;">
                                    <div class="form-group">
                                        <label for="topText" class="mb-1">
                                            Content <i class="fas fa-info-circle text-muted info-tooltip" title="Placeholders: {page}, {pages}, {date}, {time}, {datetime}"></i>
                                        </label>
                                        <input id="topText" class="form-control form-control-sm" type="text" value="" onChange="preview()" placeholder="e.g. Page {page} of {pages}">
                                    </div>
                                    <div class="form-group">
                                        <label for="topTextSizePt" class="mb-1">Font Size (pt)</label>
                                        <input id="topTextSizePt" class="form-control form-control-sm" type="number" min="0" max="999" step="0.1" value="0" onChange="preview()" placeholder="Auto (uses markdown font size)">
                                    </div>
                                    <div class="form-check mb-0">
                                        <input class="form-check-input" type="checkbox" id="topDivider" onChange="preview()">
                                        <label class="form-check-label" for="topDivider">Separator line</label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Bottom Area -->
                        <div class="tab-pane fade" id="bottomAreaContent" role="tabpanel">
                            <div class="form-check border-area-enable-toggle">
                                <input class="form-check-input" type="checkbox" id="enableBottomArea" onChange="toggleHeaderArea('bottom'); preview()">
                                <label class="form-check-label" for="enableBottomArea">Enable Bottom Area</label>
                            </div>
                            <div id="bottomAreaOptions" class="border-area-options" style="display: none;">
                                <!-- Area Sizing -->
                                <div class="form-group">
                                    <label for="bottomAreaMm" class="small-bold-label">Area Height (mm)</label>
                                    <input id="bottomAreaMm" class="form-control form-control-sm" type="number" min="0" max="999.9" step="0.5" value="0" onChange="preview()">
                                </div>

                                <!-- Content Type Selector -->
                                <div class="form-group">
                                    <label class="small-bold-label">Content Type</label>
                                    <div class="btn-group btn-group-toggle w-100 content-type-selector" data-toggle="buttons">
                                        <label class="btn btn-outline-secondary active" id="bottomContentNone">
                                            <input type="radio" name="bottomContentType" value="none" onchange="toggleBorderContentType('bottom', 'none'); preview()" checked>
                                            <span class="fas fa-ban"></span> None
                                        </label>
                                        <label class="btn btn-outline-secondary" id="bottomContentBar">
                                            <input type="radio" name="bottomContentType" value="bar" onchange="toggleBorderContentType('bottom', 'bar'); preview()">
                                            <span class="fas fa-bars"></span> Bar
                                        </label>
                                        <label class="btn btn-outline-secondary" id="bottomContentText">
                                            <input type="radio" name="bottomContentType" value="text" onchange="toggleBorderContentType('bottom', 'text'); preview()">
                                            <span class="fas fa-font"></span> Text
                                        </label>
                                    </div>
                                </div>

                                <!-- Bar Settings -->
                                <div id="bottomBarContent" class="border-content-section" style="display: none;">
                                    <div class="form-row">
                                        <div class="form-group col-4">
                                            <label for="bottomBarMm">Height (mm)</label>
                                            <input id="bottomBarMm" class="form-control form-control-sm" type="number" min="0" max="999.9" step="0.5" value="0" onChange="preview()">
                                        </div>
                                        <div class="form-group col-4">
                                            <label for="bottomBarTextSizePt">Text (pt)</label>
                                            <input id="bottomBarTextSizePt" class="form-control form-control-sm" type="number" min="0" max="999" step="1" value="0" onChange="preview()" placeholder="Auto">
                                        </div>
                                        <div class="form-group col-4">
                                            <label>Color</label>
                                            <div class="btn-group btn-group-sm btn-group-toggle w-100" data-toggle="buttons">
                                                <label class="btn btn-outline-dark active" id="bottomBarColorBlack">
                                                    <input type="radio" name="bottomBarColor" onchange="preview()" value="black" checked>B
                                                </label>
                                                {% if red_support %}
                                                <label class="btn btn-outline-danger" id="bottomBarColorRed">
                                                    <input type="radio" name="bottomBarColor" onchange="preview()" value="red">R
                                                </label>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group mb-0">
                                        <label for="bottomBarText">Label</label>
                                        <input id="bottomBarText" class="form-control form-control-sm" type="text" value="" onChange="preview()" placeholder="Bar label text">
                                    </div>
                                </div>

                                <!-- Text Settings -->
                                <div id="bottomTextContent" class="border-content-section" style="display: none;">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="bottomDivider" onChange="preview()">
                                        <label class="form-check-label" for="bottomDivider">Separator line</label>
                                    </div>
                                    <div class="form-check mt-2">
                                        <input class="form-check-input" type="checkbox" id="bottomShowPageNumbers" onChange="onBottomPageNumbersToggle(); preview()">
                                        <label class="form-check-label" for="bottomShowPageNumbers">Show page numbers</label>
                                    </div>
                                    <div id="bottomPageNumberOptions" class="mt-2" style="display: none;">
                                        <label for="bottomPageNumberMm">Number size (mm)</label>
                                        <input id="bottomPageNumberMm" class="form-control form-control-sm" type="number" min="1" max="999" value="4" onChange="preview()">
                                    </div>
                                    <div id="bottomTextOptions" class="mt-2">
                                        <label for="bottomText">
                                            Content <i class="fas fa-info-circle text-muted info-tooltip" title="Placeholders: {time}, {datetime}"></i>
                                        </label>
                                        <input id="bottomText" class="form-control form-control-sm" type="text" value="" onChange="preview()" placeholder="e.g. {time}">
                                        <label for="bottomTextSizePt" class="mt-2">Font Size (pt)</label>
                                        <input id="bottomTextSizePt" class="form-control form-control-sm" type="number" min="0" max="999" step="0.1" value="0" onChange="preview()" placeholder="Auto (uses markdown font size)">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </fieldset>
        <fieldset class="form-group" id="groupLabelImage">
            <label style="margin-top: 10px; margin-bottom: 0">Label Image:</label>
            <form class="dropzone" id="my-awesome-dropzone">
            </form>

            <!-- Image controls: Rotate and Crop -->
            <div style="margin-top: 10px; padding: 10px; background-color: #f8f9fa; border-radius: 4px;">
                <div id="sourceDimensions" style="display: none; margin-bottom: 8px; padding: 5px; background-color: #e9ecef; border-radius: 3px; font-size: 0.85em;">
                    Source: <span id="sourceWidth">?</span> × <span id="sourceHeight">?</span> mm
                </div>

                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="imageRotate90" onChange="preview()">
                    <label class="form-check-label" for="imageRotate90">Rotate 90°</label>
                </div>

                <div class="form-check" style="margin-top: 8px;">
                    <input class="form-check-input" type="checkbox" id="imageStretchLength" onChange="preview()">
                    <label class="form-check-label" for="imageStretchLength">Stretch length (no height limit)</label>
                </div>

                <div class="form-check" style="margin-top: 8px;">
                    <input class="form-check-input" type="checkbox" id="imageNoCrop" onChange="preview()">
                    <label class="form-check-label" for="imageNoCrop">Disable whitespace removal</label>
                </div>

                <label style="margin-top: 10px; margin-bottom: 5px; font-weight: 500;">Crop (mm):</label>
                <div class="row">
                    <div class="col-6">
                        <label for="imageCropLeft" style="margin-bottom: 0; font-size: 0.9em;">Left:</label>
                        <input id="imageCropLeft" class="form-control form-control-sm" type="number" min="0" max="50" step="0.5" value="0" onChange="preview()">
                    </div>
                    <div class="col-6">
                        <label for="imageCropRight" style="margin-bottom: 0; font-size: 0.9em;">Right:</label>
                        <input id="imageCropRight" class="form-control form-control-sm" type="number" min="0" max="50" step="0.5" value="0" onChange="preview()">
                    </div>
                </div>
                <div class="row" style="margin-top: 5px;">
                    <div class="col-6">
                        <label for="imageCropTop" style="margin-bottom: 0; font-size: 0.9em;">Top:</label>
                        <input id="imageCropTop" class="form-control form-control-sm" type="number" min="0" max="50" step="0.5" value="0" onChange="preview()">
                    </div>
                    <div class="col-6">
                        <label for="imageCropBottom" style="margin-bottom: 0; font-size: 0.9em;">Bottom:</label>
                        <input id="imageCropBottom" class="form-control form-control-sm" type="number" min="0" max="50" step="0.5" value="0" onChange="preview()">
                    </div>
                </div>
            </div>
        </fieldset>
    </div>
    <div class="col-md-4">
        <fieldset class="form-group">
            <label for="previewImg" style="margin-bottom: 0">Label Preview:</label><br />
            <img id="previewImg" style="border: 1px solid #ced4da; max-height: 350px; width: auto; max-width: 100%; margin-bottom: 10px;" />

            <!-- Markdown Page Navigation -->
            <div id="markdownPager" class="btn-group btn-group-sm" style="display: none; margin-bottom: 10px;">
                <button type="button" class="btn btn-secondary" id="markdownPrevPage" onClick="markdownPrevPage()"><span class="fas fa-chevron-left" aria-hidden="true"></span></button>
                <span class="btn btn-light disabled" id="markdownPageIndicator" style="pointer-events: none;">Page 1 / 1</span>
                <button type="button" class="btn btn-secondary" id="markdownNextPage" onClick="markdownNextPage()"><span class="fas fa-chevron-right" aria-hidden="true"></span></button>
            </div>

            <!-- PDF Page Navigation -->
            <div id="pdfPageNavigation" class="btn-group btn-group-sm" style="display: none; margin-bottom: 10px;">
                <button type="button" class="btn btn-secondary btn-sm" id="pdfPrevPage" onclick="changePdfPage(-1)" style="font-size: 0.875rem;">
                    <span class="fas fa-chevron-left"></span>
                </button>
                <input type="number" id="pdfPageInput" min="1" class="form-control form-control-sm" style="width: 50px; text-align: center; border-radius: 0; font-size: 0.875rem;" onchange="goToPdfPage()" title="Go to page">
                <span class="btn btn-light btn-sm disabled" id="pdfPageIndicator" style="pointer-events: none; font-size: 0.875rem;">/ <span id="pdfTotalPages" style="font-size: 0.875rem;">1</span></span>
                <button type="button" class="btn btn-secondary btn-sm" id="pdfNextPage" onclick="changePdfPage(1)" style="font-size: 0.875rem;">
                    <span class="fas fa-chevron-right"></span>
                </button>
            </div>

            <p>Printed size w/o margins: <span id="labelWidth">?</span> cm x <span id="labelHeight">?</span> cm</p>

            <div class="form-group">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 10px; margin-bottom: 5px;">
                    <label for="printerSelect" style="margin-bottom: 0">Printer:</label>
                    <a href="/labeldesigner/printers" class="btn btn-sm btn-outline-secondary" title="Manage Printers">
                        <span class="fas fa-cog"></span>
                    </a>
                </div>
                <select id="printerSelect" class="form-control">
                    <option value="">Loading...</option>
                </select>
            </div>

            <div id="pageRange" class="form-group" style="display: none; margin-bottom: 15px;">
                <label for="pageFrom" style="margin-bottom: 8px; font-size: 0.9rem; font-weight: 500; display: block;">Page Range:</label>
                <div class="form-row align-items-center">
                    <div class="col">
                        <input id="pageFrom" class="form-control form-control-sm" type="number" min="1" placeholder="From">
                    </div>
                    <div class="col">
                        <input id="pageTo" class="form-control form-control-sm" type="number" min="1" placeholder="To">
                    </div>
                    <div class="col-auto" style="margin-top: 2px;">
                        <button type="button" class="btn btn-outline-secondary btn-sm" id="pageRangeClear" title="Clear page range">
                            <span class="fas fa-eraser" aria-hidden="true"></span>
                        </button>
                    </div>
                </div>
            </div>

            <div class="form-group" style="margin-bottom: 10px;">
                <label for="printCount" style="margin-bottom: 5px; font-size: 0.875rem;">Print Count:</label>
                <input id="printCount" class="form-control form-control-sm" type="number" min="1" max="100" value="1" required>
            </div>

            <div class="btn-group btn-block" style="margin-top: 10px;">
                <button type="button" id="printButton" class="btn btn-block btn-primary btn-lg" onClick="print()">
                    <span class="fas fa-print" aria-hidden="true"></span> Print
                </button>
                <button type="button" class="btn btn-primary dropdown-toggle dropdown-toggle-split" id="dropdownPrintButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" data-reference="parent">
                    <span class="sr-only">Toggle Dropdown</span>
                </button>
                <div class="dropdown-menu" aria-labelledby="dropdownPrintButton">
                    <a class="dropdown-item" href="#" onClick="print(true)">Cut only once</a>
                </div>
            </div>

        </fieldset>
        <div class="card">
            <div class="card-header">
                <span class="fas fa-terminal" aria-hidden="true" style="margin-right: 0.3em"></span> Status
            </div>
            <div id="statusPanel" class="card-body">
                <div id="statusBox" class="alert alert-secondary" role="alert"><span>Idle...</span></div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block javascript %}
{{ super() }}
{% include "main.js" %}
{% endblock %}
